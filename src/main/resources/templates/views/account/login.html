<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>WOOFLY</title>
<link rel="icon" href="/image/woofly.png">
<style>
	.active {
		color: black !important;
		font-weight: 700 !important;
	}
	
	.border-bottom input:focus {
        outline: none;
    }
</style>
</head>
<body>
	<!-- top navigation bar -->
	<!-- 마이 페이지에 공통으로 들어가는 navigation bar -->
	<div th:replace="~{common/top :: top}"></div>
	<!-- 메인 네비게이션 바 아래 있는 모든 요소들 -->
	<main>
		<div class="d-flex justify-content-center mx-5">
			<!-- 아래만 수정해주세요 -->
			<!-- 아래만 수정해주세요 -->
			<!-- 아래만 수정해주세요 -->
			<!-- 아래만 수정해주세요 -->
			<!-- 아래만 수정해주세요 -->
			<!-- 아래만 수정해주세요 -->
			<div class="col-10 pt-3 mb-5 d-flex justify-content-center">
				<div>
					<div class="text-center">
						<img src="/image/woofly.png" style="width:200px">
					</div>	
					<br>
					<form action="/login.dw" method="post" onsubmit="return checkData()">
						<div class="mt-3">
							<p>아이디</p>
							<div class="border-bottom d-flex justify-content-between">
								<input id="mbId" type="text" name="mbId" style="border: none; background: transparent;">
							</div>
						</div>
						<br>
						<div class="mb-3">
							<p>비밀번호</p>
							<div class="border-bottom d-flex justify-content-between">
								<input id="mbPwd" type="password" name="mbPwd" style="border: none; background: transparent;">
							</div>
						</div>
						<br>
						<div>
							<button type="submit" id="loginBtn" class="btn btn-outline-white mb-3 text-white" style="background-color: #ebebeb; width:100%">로그인</button>
						</div>
						<input type="hidden" name="beforeURL"> <!-- 로그인하면 이전 페이지로 넘어가는 코드 -->
					</form>
					<br>
					<div class="gap-3 d-flex">
						<a role="button" class="text-secondary" id="testBtn">회원가입</a>
							<div class="modal fade" id="testModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
								<div class="modal-dialog modal-dialog-centered" role="document">
									<div class="modal-content">
										<div class="modal-header">
											<h5 class="modal-title" id="exampleModalLabel">회원가입</h5>
											<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
										</div>
										<div class="modal-body">
											<div class="mt-2 d-flex flex-column align-items-center">
										        <div class="mb-3">
										            <a href="/account/signUp" role="button" class="btn btn-outline-dark" style="width: 200px;">이메일로 회원가입</a>
										        </div>
										        <div class="mb-3">
										            <button class="btn btn-outline-dark" style="width: 200px;">카카오로 회원가입</button>
										        </div>
										    </div>
										</div>
									</div>
								</div>
							</div>
						<p class="text-secondary">|</p>
						<a href="/account/findId" role="button" class="text-secondary">아이디 찾기</a>
						<p class="text-secondary">|</p>
						<a href="/account/findPwd" role="button" class="text-secondary">비밀번호 찾기</a>
					</div>
					<br>
					<div class="">
						<button class="btn btn-outline-dark mb-3" style="width:100%">카카오로 간편 로그인</button>
					</div>
				</div>
			</div>
			<!-- 여기까지가 수정 -->
			<!-- 여기까지가 수정 -->
			<!-- 여기까지가 수정 -->
			<!-- 여기까지가 수정 -->
			<!-- 여기까지가 수정 -->
			<!-- 여기까지가 수정 -->
			<!-- 여기까지가 수정 -->
			<!-- 여기까지가 수정 -->
		</div>
	</main>
	<script>
		const myNav = document.getElementById("myNav4");
		$(myNav).removeClass('text-secondary');
		$(myNav).addClass('active');
		
		$('#testBtn').click(function(e){
			e.preventDefault();
			$('#testModal').modal("show");
		});
		
		//input값에 데이터가 있으면 버튼 색상 변경
		document.getElementById('mbPwd').addEventListener('keyup', function() {
			const id = document.getElementById('mbId')
			const pwd = document.getElementById('mbPwd')
			const loginBtn = document.getElementById('loginBtn');
			
			if (id !== '' && pwd !== '') {
	            loginBtn.style.backgroundColor = 'black';
	        } else {
	            loginBtn.style.backgroundColor = '#ebebeb';
	        }
			
		});
         
		//null값이면 경고
	    function checkData() {
	        const id = document.getElementById('mbId').value.trim();
	        const pwd = document.getElementById('mbPwd').value.trim();
			
	        if (id === '' || pwd === '') {
	            alert('아이디와 비밀번호를 모두 입력하세요.');
	            return false;
	        } else {
	        	document.querySelector('form').submit()
	        	return true;
	        }
	    }
		
		window.onload = () =>{
			const beforeURL = document.referrer; //이전 URL 정보를 갖고잇음
			document.getElementsByName('beforeURL')[0].value = beforeURL;
		}
		
		Kakao.init('b44d15cda5fc3d137d1fdef5b7c6ee60'); //발급받은 키 중 javascript키를 사용해준다.
		//console.log(Kakao.isInitialized()); // sdk초기화여부판단
		//카카오로그인 시 API 이용하여 정보 받아오기 - 02.10 장재호
		//naverCallback.jsp와 같은 형식이니 참조하세요
		function kakaoLogin() {
		    Kakao.Auth.login({
		      success: function (response) {
		        Kakao.API.request({
		          url: '/v2/user/me',
		          success: function (response) {
		        	  console.log(response);
		        	  const id = response.id;
		        	  const nickname = response.properties.nickname;
		        	  const email = response.kakao_account.email;
		        	  $.ajax({
		        		  type : 'post',
		        		  url : 'user/kakaoLogin',
		        		  data : {"id" : id, "nickname" : nickname, "email" : email},
		        		  dataType : 'text',
		        		  success: function(result){
		        			  if(result=="ok"){
		        				  var newNickname = prompt('사용하실 닉네임을 입력해주세요');
		        				  if(newNickname != null){
		        					  $.ajax({
		        						  type : 'post',
		        						  url : 'kakaoSignUp',
		        						  data : {"id" : id, "nickname" : newNickname, "email": email}
		        					  });
		        					  alert(newNickname + "님 환영합니다.");
		        					  location.href = "/video/list";
		        				  }
		        				  else{
		        					  location.href = "/user/signin";
		        				  }
		        			  }
		        			  else{
		        				  $.ajax({
		        					  url : '/user/kakaoLogins',
		        					  data : {"id" : id},
		        					  dataType : 'text',
		        					  type : 'post',
		        					  success : function(data){
		        						  console.log(data);
		                				  alert(data + "님 반갑습니다.")
		                				  location.href = "/video/list";
		        					  }
		        				  })

		        			  }
		        		  }
		        		  
		        	  })
		          },
		          fail: function (error) {
		            console.log(error)
		          },
		        })
		      },
		      fail: function (error) {
		        console.log(error)
		      },
		    })
		  }
	</script>
	<script src="https://developers.kakao.com/sdk/js/kakao.min.js"></script>
</body>
</html>