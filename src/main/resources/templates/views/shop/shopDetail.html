<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://code.jquery.com/jquery-3.6.1.min.js"></script>
    <script type="text/javascript" src="https://chir.ag/projects/ntc/ntc.js"></script>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">

	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <style>
    .fixed-top{
        position: fixed;
        top: 0; /* í™”ë©´ ì „ì²´ ë„ˆë¹„ì— ë§ê²Œ ì„¤ì • */
        background-color: white; /* í•„ìš”ì— ë”°ë¼ ë°°ê²½ ìƒ‰ìƒ ì¶”ê°€ */
        z-index: 100; /* í•„ìš”ì— ë”°ë¼ z-index ì¡°ì ˆ */
        width:auto;
    }

	.sumDiv {
		height: 80%;
	}

    .product-image {
    	 width: 100%;
         height: 100%;
     }

    .img-thumbnail {
         height: 800px;
         width: auto;
    }

    .btn-outline-success.btn-lg {
        font-size: 1.5rem;
        padding: 0.75rem 1.25rem;
    }

    .product_btns {
        align-items: center;
        top: 0;
        right: 0;
        margin: 10px;
    }

    .product_btns > * {
        margin-bottom: 10px;
        width: 100%;
        max-width: 150px;
    }
        
    
    .colors {
    	pointer-events: none;
    }
    
    .colorsName{
    	width: 78px;
    	height: 27px;
    	font-size: 12px;
    	border: none;
  		background: transparent;
    }

	.drop-menu {
      display: none;
      position: absolute;
      background-color: #fff;
      min-width: 80px;
      box-shadow: 0 8px 16px rgba(0,0,0,0.2);
      z-index: 1;
      list-style-type: none;
      margin: 2px;
      padding-left: 0px;
    }

    .drop-menu.show {
      display: block;
      
    }

    .drop-item {
      display: block;
      width: 100%;
      padding: 5px;
      text-align: left;
      border: none;
      background: none;
      cursor: pointer;
      padding-left: 15px;
      
    }
    
    .drop-item:hover{
    	background: silver;
    }
    </style>
</head>
<body>
    <!-- tap -->
    <div th:replace="~{common/top :: top}"></div>
    <main>
        <div class="container">
            <div class="d-flex justify-content-center">
                <div class="row">
                	<th:block th:each="t, i: ${tList}">
	                    <div class="col"  th:if="${i.index == 0}">
	                        <img class="product-image img-thumbnail rounded mx-auto d-block" th:src="'/image/shopFiles/' + ${ t.renameName }" alt="ìƒí’ˆì´ë¦„" width="80%">
	                    </div>
	                </th:block>
                    <div class="row" >
	                    <div class="sumDiv col" th:each="t, i: ${tList}" th:if="${i.index > 0}">
	                        <img class="product-image m-1 p-1" th:src="'/image/shopFiles/' + ${ t.renameName }" width="20%">
	                    </div>
                    </div>
                </div>
                
                <!-- ë²„íŠ¼ ë”°ë¼ì„œ action ë³€ê²½ -->
                <div class="product m-2 col-4">
              		<form id="productForm">
              			<input type="hidden" th:value="${p.productId}" name="productId">
              			<input type="hidden" value="N" name="isMove" id="isMove">
              			<input type="hidden" th:value="${page}" name="page">
	                    <div class="product_info border-1 border-secondary border-bottom">
	                        <div class="fw-bold row">
	                            <p class="fs-2 col-10" th:text="${p.productName}"></p>
	                            <!-- ê´€ë¦¬ìì•„ì´ë”” ì¼ ë•Œë§Œ -->
	                            <p class="col-2" th:if="${ session.loginUser != null && session.loginUser.isAdmin == 'Y'}">
	                            	<button type="button" class="btn btn-outline-dark btn-sm p-1 m-1" id="editBtn">Edit</button>
	                            </p>
	                        </div>
	                        <div id="stampImgParent">
	                            <p class="fs-4">
	                            	<span class="reviewWord">ë¦¬ë·° : [[${rList.size}]]ê±´</span> /
	                            	<span class="stampWord">ì°œí•˜ê¸° : [[${savedCount}]]ê±´ </span>
	                            	<span class="stampImg isFill" th:unless="${stampCount == 0}">â¤</span>
	                            	<span class="stampImg isEmpty" th:if="${stampCount == 0}">ğŸ¤</span>
	                            </p>
	                        </div>
	                        <div>
	                            <p class="fs-4">ê°€ê²© : [[${#numbers.formatInteger(p.price, 3, 'COMMA')}]]ì›</p>
	                        </div>
	                    </div>
	                    <ul class="list-unstyled pt-4">
	                        <li class="fs-3 d-flex p-2 justify-content-between">
	                            <div class="fw-bold">ë°°ì†¡ì •ë³´</div>
	                            <div id="deli" class="fs-4"></div>
	                        </li>
	                         <li class="fs-3 d-flex p-2 justify-content-between">
	                        	<div class="fw-bold">í˜„ì¬ ë‚¨ì€ ìˆ˜ëŸ‰</div>
	                        	<div class="fs-4">[[${#numbers.formatInteger(p.quantity, 3, 'COMMA')}]]ê°œ</div>
	                        </li>
	                        <li class="fs-2 pt-4 d-flex justify-content-between">
	                            <div class="fw-bold">ì‚¬ì´ì¦ˆ</div>
	                            <div class="sizeSelect" th:if="${p.usedStandard == 'Y'}">
	                                <input type="radio" class="btn-check" name="pSize" id="optionS" autocomplete="off" value="S" checked>
	                                <label class="btn btn-outline-success btn-lg" for="optionS">S</label>
	                                <input type="radio" class="btn-check" name="pSize" id="optionM" autocomplete="off" value="M">
	                                <label class="btn btn-outline-success btn-lg" for="optionM">M</label>
	                                <input type="radio" class="btn-check" name="pSize" id="optionL" autocomplete="off" value="L">
	                                <label class="btn btn-outline-success btn-lg" for="optionL">L</label>
	                                <input type="radio" class="btn-check" name="pSize" id="optionXL" autocomplete="off" value="XL">
	                                <label class="btn btn-outline-success btn-lg" for="optionXL">XL</label>
	                            </div>
	                            <div class="sizeSelect" th:unless="${p.usedStandard == 'Y'}">
	                            	<span class="fs-5 fw-bold">ì‚¬ì´ì¦ˆ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</span>
	                            </div>
	                        </li>
	                        
	                        <li class="fs-3 d-flex p-2 justify-content-between">
	                        	
	                        	<div class="fw-bold">ìƒ‰ìƒ ì •ë³´</div>
	                        	<div class="asdasdasd d-flex">
		                        	<div th:if="${colors != null}" class="colorSelect">
		                        		<th:block  th:each="color, i: ${colors}">
			                        		<input class="colors p-1 m-2" type="color"  th:value="${color}">
			                        		<input type="text" class="colorsName">
			                        		<input type="radio" name="colors" th:value="${color}" th:checked="${i.index == 0}">
		                        		</th:block>
		                        	</div>
	                        	</div>
	                        	<div th:unless="${colors != null}">
	                            	<span class="fs-5 fw-bold">ìƒ‰ìƒ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</span>
	                            </div>
	                        </li>
	                        <li class="fs-3 d-flex p-2 justify-content-between">
	                        	<div class="fw-bold">ìˆ˜ëŸ‰ ì„ íƒ</div>
	                        	<div class="quantity">
	                        		<input type="number" class="form-control" value="1" min="1" max="100" name="quantity">
	                        	</div>
	                        </li>
	                    </ul>
	                    <div class="p-2 col product_btns" aria-label="Large button group">
	                        <button type="button" class="btn btn-outline-info rounded-pill m-1" id="buyBtn">êµ¬ë§¤í•˜ê¸°</button>
	                        <button type="button" class="btn btn-outline-info rounded-pill m-1" id="stampBtn">ì°œí•˜ê¸°</button>
	                        <button type="button" class="btn btn-outline-info rounded-pill m-1" id="putBtn">ì¥ë°”êµ¬ë‹ˆì— ë‹´ê¸°</button>
	                        <button type="button" class="btn btn-outline-info rounded-pill m-1" id="goToReply">ë¦¬ë·° ë³´ê¸°</button>
	                    </div>
               		</form>
                </div>
            </div>
            <div class="product-detail pt-4">
                <table class="table border" th:if="${p.usedStandard == 'Y'}">
                    <tr>
                        <th>ì‚¬ì´ì¦ˆ ì •ë³´</th>
                        <th>S</th>
                        <th>M</th>
                        <th>L</th>
                        <th>XL</th>
                    </tr>
                    <tr>
                        <th>ëª¸ë¬´ê²Œ</th>
                        <td>2~3KG</td>
                        <td>4~5KG</td>
                        <td>5~7KG</td>
                        <td>5~7KG</td>
                    </tr>
                    <tr>
                        <th>CHEST</th>
                        <td>48cm</td>
                        <td>49cm</td>
                        <td>51cm</td>
                        <td>57cm</td>
                    </tr>
                    <tr>
                        <th>NECK</th>
                        <td>35cm</td>
                        <td>38cm</td>
                        <td>43cm</td>
                        <td>46cm</td>
                    </tr>
                </table>
                <div class="d-flex border-top border-bottom border-3 border-black row">
                    <div class="pt-2 pb-3 fw-bold fs-4">
                        ìƒí’ˆ ìœ ì˜ì‚¬í•­
                    </div>
                    <div class="table-bordered m-2">
                        <div class="d-flex pb-2">
                            <div class="col-3 fw-bold">
                                <span>ì¬í™”ë“±ì˜ ë°°ì†¡ë°©ë²•ì— ê´€í•œ ì •ë³´</span>
                            </div>
                            <div class="col-9">
                                <p>ë°°ì†¡ë°©ì‹ ë° ì¶œê³ ì¼ ë“±ì€ ìƒí’ˆ ìƒì„¸í˜ì´ì§€ ì°¸ì¡°</p>
                            </div>
                        </div>
                        <div class="d-flex pb-2">
                            <div class="col-3 fw-bold">
                                <span>ì£¼ë¬¸ ì´í›„ ì˜ˆìƒë˜ëŠ” ë°°ì†¡ê¸°ê°„</span>
                            </div>
                            <div class="col-9">
                                <p>ì£¼ë¬¸ì¼ë¡œë¶€í„° í‰ê·  3ì¼ ì´ë‚´ì— ë°œì†¡ (ì²œì¬ì§€ë³€ ë˜ëŠ” ìƒí’ˆ ìˆ˜ê¸‰ ìƒí™©, íƒë°°ì‚¬ ì‚¬ì • ë“±ì— ë”°ë¼ ì§€ì—°ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.)</p>
                            </div>
                        </div>
                        <div class="d-flex pb-2">
                            <div class="col-3 fw-bold">
                                <span>ì œí’ˆí•˜ìÂ·ì˜¤ë°°ì†¡ ë“±ì— ë”°ë¥¸ ì²­ì•½ì² íšŒ ë“±ì˜ ê²½ìš° ì²­ì•½ì² íšŒ ë“±ì„ í•  ìˆ˜ ìˆëŠ” ê¸°ê°„ ë° í†µì‹ íŒë§¤ì—…ìê°€ ë¶€ë‹´í•˜ëŠ” ë°˜í’ˆë¹„ìš© ë“±ì— ê´€í•œ ì •ë³´</span>
                            </div>
                            <div class="col-9">
                                <p>ì „ììƒê±°ë˜ë“±ì—ì„œì˜ì†Œë¹„ìë³´í˜¸ì—ê´€í•œë²•ë¥  ë“±ì— ì˜í•œ ì œí’ˆì˜ í•˜ì ë˜ëŠ” ì˜¤ë°°ì†¡ ë“±ìœ¼ë¡œ ì¸í•œ ì²­ì•½ì² íšŒì˜ ê²½ìš°ì—ëŠ” ìƒí’ˆ ìˆ˜ë ¹ í›„ 3ê°œì›” ì´ë‚´, ê·¸ ì‚¬ì‹¤ì„ ì•ˆ ë‚  ë˜ëŠ” ì•Œ ìˆ˜ ìˆì—ˆë˜ ë‚ ë¡œë¶€í„° 30ì¼ ì´ë‚´ì— ì²­ì•½ì² íšŒë¥¼ í•  ìˆ˜ ìˆìœ¼ë©°, ë°˜í’ˆ ë¹„ìš©ì€ í†µì‹ íŒë§¤ì—…ìê°€ ë¶€ë‹´í•©ë‹ˆë‹¤.</p>
                            </div>
                        </div>
                        <div class="d-flex pb-2">
                            <div class="col-3 fw-bold">
                                <span>ì œí’ˆí•˜ìê°€ ì•„ë‹Œ ì†Œë¹„ìì˜ ë‹¨ìˆœë³€ì‹¬, ì°©ì˜¤êµ¬ë§¤ì— ë”°ë¥¸ ì²­ì•½ì² íšŒ ë“±ì˜ ê²½ìš° ì²­ì•½ì² íšŒ ë“±ì„ í•  ìˆ˜ ìˆëŠ” ê¸°ê°„ ë° ì†Œë¹„ìê°€ ë¶€ë‹´í•˜ëŠ” ë°˜í’ˆë¹„ìš© ë“±ì— ê´€í•œ ì •ë³´</span>
                            </div>
                            <div class="col-9">
                                <p>í¸ë„ 3,000 ì› (ìµœì´ˆ ë°°ì†¡ë¹„ê°€ ë¬´ë£Œì¸ ê²½ìš° ì™•ë³µìœ¼ë¡œ ë¶€ê³¼ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.)</p>
                            </div>
                        </div>
                        <div class="d-flex pb-2">
                            <div class="col-3 fw-bold">
                                <span>ì œí’ˆí•˜ìê°€ ì•„ë‹Œ ì†Œë¹„ìì˜ ë‹¨ìˆœë³€ì‹¬, ì°©ì˜¤êµ¬ë§¤ì— ë”°ë¥¸ ì²­ì•½ì² íšŒê°€ ë¶ˆê°€ëŠ¥í•œ ê²½ìš° ê·¸ êµ¬ì²´ì  ì‚¬ìœ ì™€ ê·¼ê±°</span>
                            </div>
                            <div class="col-9">
                                <p>ì „ììƒê±°ë˜ë“±ì—ì„œì˜ ì†Œë¹„ìë³´í˜¸ì—ê´€í•œë²•ë¥  ë“±ì— ì˜í•œ ì²­ì•½ì² íšŒ ì œí•œ ì‚¬ìœ ì— í•´ë‹¹í•˜ëŠ” ê²½ìš° ë° ê¸°íƒ€ ê°ê´€ì ìœ¼ë¡œ ì´ì— ì¤€í•˜ëŠ” ê²ƒìœ¼ë¡œ ì¸ì •ë˜ëŠ” ê²½ìš° ì²­ì•½ì² íšŒê°€ ì œí•œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                            </div>
                        </div>
                        <div class="d-flex pb-2">
                            <div class="col-3 fw-bold">
                                <span>ì¬í™” ë“±ì˜ êµí™˜Â·ë°˜í’ˆÂ·ë³´ì¦ ì¡°ê±´ ë° í’ˆì§ˆë³´ì¦ê¸°ì¤€</span>
                            </div>
                            <div class="col-9">
                                <p>ì†Œë¹„ìë¶„ìŸí•´ê²°ê¸°ì¤€(ê³µì •ê±°ë˜ìœ„ì›íšŒ ê³ ì‹œ) ë° ê´€ê³„ë²•ë ¹ì— ë”°ë¦…ë‹ˆë‹¤.</p>
                            </div>
                        </div>
                        <div class="d-flex pb-2" >
                            <div class="col-3 fw-bold">
                                <span>ëŒ€ê¸ˆì„ í™˜ë¶ˆë°›ê¸° ìœ„í•œ ë°©ë²•ê³¼ í™˜ë¶ˆì´ ì§€ì—°ë  ê²½ìš° ì§€ì—°ì— ë”°ë¥¸ ë°°ìƒê¸ˆì„ ì§€ê¸‰ë°›ì„ ìˆ˜ ìˆë‹¤ëŠ” ì‚¬ì‹¤ ë° ë°°ìƒê¸ˆ ì§€ê¸‰ì˜ êµ¬ì²´ì  ì¡°ê±´ ë° ì ˆì°¨ì¤€</span>
                            </div>
                            <div class="col-9">
                                <p>ì£¼ë¬¸ ì·¨ì†Œ ë° ëŒ€ê¸ˆì˜ í™˜ë¶ˆì€ ë§ˆì´í˜ì´ì§€ì—ì„œ ì‹ ì²­í•  ìˆ˜ ìˆìœ¼ë©°, ì „ììƒê±°ë˜ ë“±ì—ì„œì˜ ì†Œë¹„ìë³´í˜¸ì— ê´€í•œ ë²•ë¥ ì— ë”°ë¼ ì†Œë¹„ìì˜ ì²­ì•½ì² íšŒ í›„ íŒë§¤ìê°€ ì¬í™” ë“±ì„ ë°˜í™˜ ë°›ì€ ë‚ ë¡œë¶€í„° 3ì˜ì—…ì¼ ì´ë‚´ì— ì§€ê¸‰ë°›ì€ ëŒ€ê¸ˆì˜ í™˜ê¸‰ì„ ì •ë‹¹í•œ ì‚¬ìœ  ì—†ì´ ì§€ì—°í•˜ëŠ” ë•Œì—ëŠ” ì†Œë¹„ìëŠ” ì§€ì—°ê¸°ê°„ì— ëŒ€í•´ì„œ ì—° 15%ì˜ ì§€ì—°ë°°ìƒê¸ˆì„ íŒë§¤ìì—ê²Œ ì²­êµ¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                            </div>
                        </div>
                        <div class="d-flex pb-2">
                            <div class="col-3 fw-bold">
                                <span>ì†Œë¹„ìí”¼í•´ë³´ìƒì˜ ì²˜ë¦¬, ì¬í™” ë“±ì— ëŒ€í•œ ë¶ˆë§Œ ì²˜ë¦¬ ë° ì†Œë¹„ìì™€ ì‚¬ì—…ì ì‚¬ì´ì˜ ë¶„ìŸì²˜ë¦¬ì— ê´€í•œ ì‚¬í•­</span>
                            </div>
                            <div class="col-9">
                                <p>ì†Œë¹„ìë¶„ìŸí•´ê²°ê¸°ì¤€(ê³µì •ê±°ë˜ìœ„ì›íšŒ ê³ ì‹œ) ë° ê´€ê³„ë²•ë ¹ì— ë”°ë¦…ë‹ˆë‹¤.</p>
                            </div>
                        </div>
                        <div class="d-flex pb-2">
                            <div class="col-3 fw-bold">
                                <span>ê±°ë˜ì— ê´€í•œ ì•½ê´€ì˜ ë‚´ìš© ë˜ëŠ” í™•ì¸í•  ìˆ˜ ìˆëŠ” ë°©ë²•</span>
                            </div>
                            <div class="col-9">
                                <p>í˜ì´ì§€ í•˜ë‹¨ì˜ ì´ìš©ì•½ê´€ ë§í¬ë¥¼ í†µí•´ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="product_images pt-4 text-center">
                    <h1 class="pb-4">ìƒí’ˆ ìƒì„¸ì •ë³´</h1>
                    <img class="h-auto m-2 p-2" style="width:98%" th:each="con: ${conList}" th:src="'/image/shopFiles/' + ${ con.renameName}">
                </div>
                <div class="reply mt-4 border-1 border-dark border-top">
                    <h1 class="pt-4 text-center">ìƒí’ˆ ë¦¬ë·°</h1>
                    <div class="input-group">
                        <span class="input-group-text">ë¦¬ë·°<br>ë‚´ìš©</span>
                        <textarea class="form-control" rows="4" placeholder="ì†Œì¤‘í•œ ë¦¬ë·°ë¥¼ ë‚¨ê²¨ì£¼ì„¸ìš”." style="resize: none;" id="replyContent"></textarea>
                        <button type="button" class="btn btn-outline-success btn-lg" id="insertReply">ë“±ë¡</button>                        
                    </div>                                           
                    
                    <!-- ëŒ“ê¸€ ì¡°íšŒ ì˜ì—­ -->
                    <!-- ì¢‹ì•„ìš” ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸, ë‚´ ëŒ“ê¸€ì´ë©´ ìˆ˜ì • ì‚­ì œ -->
                    <div id="replyContents">
	                    <div class="comment-container d-flex mt-3 justify-content-center text-center border-top border-black replyOne" th:each="r: ${rList}">
	                    	<input type="hidden" th:value="${r.rNo}">
	                        <div class="col-1" style="line-height: 40px;">[[${r.mbNickName}]]</div>
	                        <div class="col-8 reContent" style="line-height: 40px;">[[${r.reContent}]]</div>
	                        <div class="col-1" style="line-height: 40px;">[[${r.reDate}]]</div>
	                        <div class="col-2 d-flex align-items-center justify-content-end m-1 utility" name="devDiv">
	                        	<div class="mx-2">
	                        		[[${r.reLike}]]
	                        	</div>
	                        	<div class="changeImage">
								    <th:block th:if="${r.userLiked}">
								        <!-- ì‚¬ìš©ìê°€ ì¢‹ì•„ìš”ë¥¼ ëˆ„ë¥¸ ê²½ìš° -->
								        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="black" viewBox="0 0 16 16">
								            <path d="M8 1.314C12.438-3.248 23.534 4.735 8 15-7.534 4.736 3.562-3.248 8 1.314z"/>
								        </svg>
								    </th:block>
								    <th:block th:unless="${r.userLiked}">
								        <!-- ì‚¬ìš©ìê°€ ì¢‹ì•„ìš”ë¥¼ ëˆ„ë¥´ì§€ ì•Šì€ ê²½ìš° -->
								        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="white" viewBox="0 0 16 16">
								            <path d="m8 2.748-.717-.737C5.6.281 2.514.878 1.4 3.053c-.523 1.023-.641 2.5.314 4.385.92 1.815 2.834 3.989 6.286 6.357 3.452-2.368 5.365-4.542 6.286-6.357.955-1.886.838-3.362.314-4.385C13.486.878 10.4.28 8.717 2.01zM8 15C-7.333 4.868 3.279-3.04 7.824 1.143c.06.055.119.112.176.171a3.12 3.12 0 0 1 .176-.17C12.72-3.042 23.333 4.867 8 15"/>
								        </svg>
								    </th:block>
								</div>
	
		                        <div class="dropend  me-2">
		                        	<button type="button" class="btn drop-btn" aria-expanded="false">
			                            <svg xmlns="http://www.w3.org/2000/svg" width="13" height="13" fill="currentColor" class="bi bi-three-dots-vertical" viewBox="0 0 16 16">
			                                <path d="M9.5 13a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0m0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0m0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0"/>
			                            </svg>
		                            </button>
		                            <ul class="drop-menu">
		                                <li><button class="drop-item" data-bs-toggle="modal" data-bs-target="#modal1">ì‹ ê³ </button></li>
		                                <th:block th:if="${ session.loginUser != null && session.loginUser.mbId == r.mbId}">
			                                <li><button class="drop-item replyUpdate" type="button">ìˆ˜ì •</button></li>
			                                <li><button class="drop-item replyDelete" type="button">ì‚­ì œ</button></li>
		                                </th:block>
		                            </ul>
		                        </div>
	                        </div>
	                    </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    
    
    
    <!-- ì‹ ê³  ëª¨ë‹¬ -->
    <div class="modal fade" tabindex="-1" role="dialog" id="confirm">
        <div class="modal-dialog" role="document">
            <div class="modal-content rounded-1 shadow">
                <div class="modal-body p-4 text-center fs-4 fw-bold">
                	
                </div>
                <div class="modal-body p-2 fw-bold fs-6">
                
                </div>
                <div class="modal-footer flex-nowrap p-1">
                    <button type="button" class="btn btn-lg btn-link fs-6 text-decoration-none col-6 m-0 rounded-0 border-end" id="submitForm">
                        <strong>ë„¤</strong>
                     </button>
                     <button type="button" class="btn btn-lg btn-link fs-6 text-decoration-none col-6 m-0 rounded-0" data-bs-dismiss="modal">ì•„ë‹ˆì˜¤</button>
                </div>
            </div>
        </div>
    </div>
    
</body>
<script th:inline="javascript">

	let oldData;
	window.onload = () =>{

		/*<![CDATA[*/
		const p = /*[[${p}]]*/1;
		const loginUser = /*[[${session.loginUser}]]*/1;
		let savedCount = /*[[${savedCount}]]*/1; 
		let reviewCount = /*[[${rList.size}]]*/1;
		/*]]>*/
		
        window.addEventListener('scroll', function () {
            var scrollY = window.scrollY || document.documentElement.scrollTop;

            // ì¼ì • yì¶• ì¢Œí‘œë¥¼ ê¸°ì¤€ìœ¼ë¡œ í™•ì¸
            var triggerY = 950; // ì¡°ì • ê°€ëŠ¥

            // yì¶• ì¢Œí‘œê°€ triggerY ì´ìƒì´ë©´ fixed-topìœ¼ë¡œ ë³€ê²½, ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ ê¸°ë³¸ ìƒíƒœë¡œ ë˜ëŒë¦¼
            if (scrollY > triggerY) {
                document.querySelector('.product_btns').classList.add('fixed-top');
            } else {
                document.querySelector('.product_btns').classList.remove('fixed-top');
            }
        });
        
        // ë‚´ì¼ ë‚ ì§œ ê³„ì‚°
        const deli = document.getElementById('deli');
        const today = new Date();
        const day = today.getMonth()+1  + "ì›” " 
					+ (today.getDate()+1)  + "ì¼";
        
        deli.innerHTML = "ë‚´ì¼ " + day + " ë„ì°© ì˜ˆì •";
        
        const isMove = document.getElementById('isMove');
		const form = document.getElementById('productForm');
		const quantity = document.getElementsByClassName('quantity')[0].querySelector('input');
		document.getElementById('buyBtn').addEventListener('click', () =>{
			if(loginUser != null) {
				if(quantity.value > 100) {
					alert("ìˆ˜ëŸ‰ì€ 100ê°œë¥¼ ë„˜ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
					quantity.focus();
					event.preventDefault();
				} else {
					isMove.value = 'Y';
					form.action = '/shop/payment';
					form.submit();
				}
			} else {
				alert("ë¡œê·¸ì¸ í›„ ì´ìš©í•´ì£¼ì„¸ìš”.");
			}
			
			
		});
		
		if(loginUser?.isAdmin == 'Y') {
			document.getElementById('editBtn').addEventListener('click', () => {
				form.action = '/shop/moveToUpdate';
				form.submit();
			});
		}
		
		
		document.getElementById('putBtn').addEventListener('click', () =>{
			// ì¥ë°”êµ¬ë‹ˆì— insertë§Œ í•´ë†“ê¸° ì—ì´ì‘ìŠ¤ë¡œ ì„±ê³µ ì‹œ ì•ŒëŸ¿ì°½ ì •ë„?
			if(loginUser != null) {
				if(quantity.value > 100){
					alert("ìˆ˜ëŸ‰ì€ 100ê°œë¥¼ ë„˜ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
					quantity.focus();
					event.preventDefault();
				} else {
					isMove.value = 'N';
					
					let selectedSize;
					let selectedColor;
					if(p.usedStandard == 'Y'){
						const sizeRadio = document.getElementsByClassName('sizeSelect')[0].querySelectorAll('input');
						for(const selectRadio of sizeRadio) {
							if(selectRadio.checked) {
								selectedSize = selectRadio.value;
								break;
							}
						}
					}
					if(p.color != 'N') {
				        const colorRadio = document.getElementsByClassName('colorSelect')[0].querySelectorAll('input');
				        for(const selectRadio of colorRadio){
				        	if(selectRadio.checked){
				        		selectedColor = selectRadio.value;
				        		break;
				        	}
				        }
					}
					
					$.ajax({
						url: '/shop/payment',
						data: {productId:/*[[${p.productId}]]*/9999, pSize: selectedSize == undefined ? "N" : selectedSize, colors: selectedColor == undefined ? "N" : selectedColor, quantity:quantity.value, isMove:isMove.value},
						success: data => {
							if(data == 'success') {
								/*<![CDATA[*/
								alert(/*[[${p.productName}]]*/'name' + "  " + quantity.value + "ê°œê°€ ì¥ë°”êµ¬ë‹ˆì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.");
								/*]]>*/
							} else {
								aleet("ì¥ë°”êµ¬ë‹ˆ ì¶”ê°€ì— ì‹¤íŒ¨í•˜ì—¬ í˜ì´ì§€ê°€ ìƒˆë¡œê³ ì¹¨ë©ë‹ˆë‹¤.");
								location.reload();
							}
						},
						error: data => {
							console.log(data);
						}
					});
				}
			} else {
				alert("ë¡œê·¸ì¸ í›„ ì´ìš©í•´ì£¼ì„¸ìš”.");
			}
		});
		
		
		document.getElementById('stampBtn').addEventListener('click', () => {
			const sip = document.getElementById('stampImgParent');
			const stampWord = sip.children[0].children[1];
			const stampImg = sip.children[0].children[2];
			if(loginUser != null){
				if(stampImg.classList.contains('isEmpty')) {
					$.ajax({
						url: "/shop/insertStampProduct",
						data: {mbId:loginUser.mbId, pId:p.productId, type:'P'},
						success: data => {
							console.log(data);
							if(data == 'success'){
								savedCount = savedCount + 1
								stampWord.innerText = 'ì°œí•˜ê¸° : ' + savedCount + 'ê±´';
								stampImg.innerText = 'â¤';
								stampImg.classList.remove('isEmpty');
								stampImg.classList.add('isFill');
							} else {
								alert("ì•Œìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí•˜ì—¬ í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•©ë‹ˆë‹¤.");
								location.reload();
							}
						},
						error: data => {
							console.log(data);
						}
					});	
				}
				
				if(stampImg.classList.contains('isFill')){
					$.ajax({
						url: "/shop/deleteStampProduct",
						data: {mbId:loginUser.mbId, pId:p.productId, type: 'P'},
						success: data => {
							console.log(data);
							if(data == 'success'){
								savedCount = savedCount - 1
								stampWord.innerText = 'ì°œí•˜ê¸° : ' + savedCount + 'ê±´';
								stampImg.innerText = 'ğŸ¤';
								stampImg.classList.remove('isFill');
								stampImg.classList.add('isEmpty');
							} else {
								alert("ì•Œìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí•˜ì—¬ í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•©ë‹ˆë‹¤.");
								location.reload();
							}
						},
						error: data => {
							console.log(data);
						}
					})
				}
					
			} else {
				alert("ë¡œê·¸ì¸ í›„ ì´ìš©í•´ì£¼ì„¸ìš”.");
			}
		});
		
		
		
		function colorNameMath(color) {
        	var match = ntc.name(color);
        	const colorName = match[1];
        	return colorName;
        }
        
		const colorsName = document.getElementsByClassName('colorsName');
		/*<![CDATA[*/
		
		let colors = /*[[${colors}]]*/1;
		if(colors == null) {
			colors = 'N';
		}
		
		if(colors != 'N') {
			let i = 0;
			for(const color of colors) {
				const colorName = colorNameMath(color);
				colorsName[i].value = colorName;
				i++;
			}
		}
			
		/*]]>*/
		
		// ë¦¬ë·° ë°”ë¡œ ë³´ëŸ¬ê°€ê¸°
		document.getElementById('goToReply').addEventListener('click', () =>{
			document.getElementById('replyContent').focus();			
		})
        
        // ëŒ“ê¸€ ì‹œì‘
        const insertBtn = document.getElementById('insertReply');
        
		const topReply = document.getElementById('replyContents');
		const reviewWord = document.getElementsByClassName('reviewWord')[0];
        /*<![CDATA[*/
		$(document).on('click', '#insertReply', function() {
			// ë¡œê·¸ì¸ ìœ ì € ë‹¤ë£¨ëŠ” ë¡œì§ ì§œê¸°
			const textarea = document.getElementById('replyContent');
			const replyContent = textarea.value;
			const p = /*[[${p}]]*/2;
			const boardNo = p.productId;
			const loginUserId = /*[[${ session.loginUser?.mbId}]]*/id;
			
			textarea.value = '';
			
			if(replyContent != '' && loginUserId != null) {
				$.ajax({
					url: '/shop/insertReply',
					data: {reContent:replyContent, bNo:boardNo, mbId:loginUserId},
					success: data => {
						topReply.innerHTML = '';
						for(const r of data.rList){
							const isLiked = r.userLiked;
							
							const newReply = `
								<div class="comment-container d-flex mt-3 justify-content-center text-center border-top border-black replyOne">
			                    	<input type="hidden" value="${r.rNo}">
			                        <div class="col-1" style="line-height: 40px;">${r.mbNickName}</div>
			                        <div class="col-8 reContent" style="line-height: 40px;">${r.reContent}</div>
			                        <div class="col-1" style="line-height: 40px;">${r.reDate}</div>
			                        <div class="col-2 d-flex align-items-center justify-content-end m-1 utility" name="devDiv">
			                        	<div class="mx-2">
			                        		${r.reLike}
			                        	</div>
			                        	<div class="changeImage">
			                        		${isLiked ? 
				                                `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="black" viewBox="0 0 16 16">
				                                    <path fill-rule="evenodd" d="M8 1.314C12.438-3.248 23.534 4.735 8 15-7.534 4.736 3.562-3.248 8 1.314z"/>
				                                </svg>`
		                        				: 
				                                `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="white" viewBox="0 0 16 16">
				                                    <path d="m8 2.748-.717-.737C5.6.281 2.514.878 1.4 3.053c-.523 1.023-.641 2.5.314 4.385.92 1.815 2.834 3.989 6.286 6.357 3.452-2.368 5.365-4.542 6.286-6.357.955-1.886.838-3.362.314-4.385C13.486.878 10.4.28 8.717 2.01zM8 15C-7.333 4.868 3.279-3.04 7.824 1.143c.06.055.119.112.176.171a3.12 3.12 0 0 1 .176-.17C12.72-3.042 23.333 4.867 8 15"/>
				                                </svg>`
			                        		}
			                        	</div>
			
				                        <div class="dropend me-2">
					                        <button type="button" class="btn drop-btn" aria-expanded="false">
					                            <svg xmlns="http://www.w3.org/2000/svg" width="13" height="13" fill="currentColor" class="bi bi-three-dots-vertical" viewBox="0 0 16 16">
					                                <path d="M9.5 13a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0m0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0m0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0"/>
					                            </svg>
											</button>
				                            <ul class="drop-menu">
				                                <li><button class="drop-item" data-bs-toggle="modal" data-bs-target="#modal1">ì‹ ê³ </button></li>
				                                <th:block th:if="${ loginUser != null && loginUser.mbId == r.mbId}">
				                                ${loginUser != null && loginUser.mbId == r.mbId ? ` 
					                                <li><button class="drop-item replyUpdate" type="button">ìˆ˜ì •</button></li>
					                                <li><button class="drop-item replyDelete" type="button">ì‚­ì œ</button></li>
					                                `
					                                :
					                                ``	
				                                }
				                                </th:block>
				                            </ul>
				                        </div>
			                        </div>
		                    	</div>
								`;
							
							topReply.innerHTML += newReply;
							
						}
						reviewCount = reviewCount + 1;
						reviewWord.innerText = 'ë¦¬ë·° : ' + reviewCount + 'ê±´';
						
					},
					error : data => {
						console.log(data);
					}
					
				})
			} else {
				alert("ë¡œê·¸ì¸ í›„ ì´ìš©í•´ì£¼ì„¸ìš”.");
			}
		});
        /*]]>*/
        // ë°›ì•„ì˜¤ëŠ” ë°ì´í„° userLikedë¡œ ë¹„êµ 
        // ë³¸ë¬¸ìœ¼ë¡œ ìƒê¸°ëŠ” ê²€ì •ìƒ‰ í•˜íŠ¸ ì ê²€
        topReply.addEventListener('click', function(event){
        	let target = event.target;
        	const changeDiv = target.closest('.changeImage');
        	const dropEnd = target.closest('.drop-btn');
        	const updateBtn = target.closest('.replyUpdate');
        	const deleteBtn = target.closest('.replyDelete');
        	const newUpdate = target.closest('.newUpdate');
        	const rollback = target.closest('.rollback');
        	//let isOut = true;
        	if(changeDiv) {
        		if(loginUser != null) {
        			const svg = changeDiv.children[0];
                	const isWhite = svg.classList.contains('white');
                	const isBlack = svg.classList.contains('black');
                	const rNo = changeDiv.parentElement.parentElement.children[0].value;
                	let likeDiv = changeDiv.parentElement.children[0];
                	let like = parseInt(likeDiv.innerText);
                	
                	if(isWhite || isBlack){
                		const ajaxURL = isWhite ? "/shop/insertReplyCount" : "/shop/downReplyCount";
                		$.ajax({
                			url: ajaxURL,
                			data: {mId:loginUser.mbId, rNo:rNo},
                			success: data => {
                				svg.classList.toggle('white');
                				svg.classList.toggle('black');
                				
                				if(isWhite) {
          						  svg.innerHTML = `<path fill-rule="evenodd" d="M8 1.314C12.438-3.248 23.534 4.735 8 15-7.534 4.736 3.562-3.248 8 1.314z"/>`;
    	      					} else {
    	      						svg.innerHTML = `<path d="m8 2.748-.717-.737C5.6.281 2.514.878 1.4 3.053c-.523 1.023-.641 2.5.314 4.385.92 1.815 2.834 3.989 6.286 6.357 3.452-2.368 5.365-4.542 6.286-6.357.955-1.886.838-3.362.314-4.385C13.486.878 10.4.28 8.717 2.01zM8 15C-7.333 4.868 3.279-3.04 7.824 1.143c.06.055.119.112.176.171a3.12 3.12 0 0 1 .176-.17C12.72-3.042 23.333 4.867 8 15"/>`;
    	      					}
                				
                				like = isWhite ? like + 1 : like - 1;
                				likeDiv.innerText = like;
                			},
                			error: data => {
                				console.log(data)
                			}
                		});
                	}
        		} else {
        			alert("ë¡œê·¸ì¸ í›„ ì´ìš©í•´ì£¼ì„¸ìš”.");
        		}
        		
        	}
        	
        	if(dropEnd) {
        		const menu = dropEnd.parentElement.children[1];
        		menu.classList.toggle('show');
        	}
        	
        	
        	if(updateBtn) {
        		const replyRow = updateBtn.closest('.utility').parentElement;
        		const reConArea = replyRow.children[2];
        		oldData = reConArea.innerText;
        		reConArea.innerHTML = '<div class="d-flex mt-1 px-2" width="85%"><input type="text" class="form-control p-5 newContent" value="' + oldData + '"><div class="row"><button type="button" class="btn btn-sm btn-success newUpdate">ì œì¶œ</button><button type="button" class="btn btn-sm btn-light rollback">ì·¨ì†Œ</button></div></div>';
        		
        		updateBtn.parentElement.parentElement.classList.remove('show');
        	}
        	
        	if(newUpdate) {
        		const newContent = newUpdate.parentElement.previousElementSibling.value;
        		const updateNo = newUpdate.closest('.replyOne').children[0].value;
        		const reConArea = newUpdate.closest('.reContent');
        		if(newContent != '' && loginUser != null) {
        			$.ajax({
        				url: '/shop/updateReply',
        				data: {rNo: updateNo, reContent:newContent},
        				success: data => {
        					if(data == 'success'){
        						reConArea.innerHTML = newContent;
        						oldData = '';
        					}
        				},
        				error: data => {
        					console.log(data);
        				}
        			});
        		}
        	}
        	
        	if(rollback) {
        		const reConArea = rollback.closest('.reContent');
        		reConArea.innerHTML = oldData;
        	}
        	
        	if(deleteBtn) {
        		const rNo = deleteBtn.closest('.replyOne').children[0].value;
        		const rContent = deleteBtn.closest('.replyOne').children[2].innerText;
        		const modal = document.getElementById('confirm');
        		deleteBtn.parentElement.parentElement.classList.remove('show');
        		
        		const modalBody = modal.querySelectorAll('.modal-body');
        		modalBody[0].innerHTML = "ë¦¬ë·° ì‚­ì œ ì‹œ ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. <br> ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?";
        		modalBody[1].innerHTML = "ë¦¬ë·° ë‚´ìš© : " + rContent + "<input type='hidden' value='" + rNo + "'>";
        		
        		$('#confirm').modal('show');
        	}
        	
        })
        
        const submitModal = document.getElementById('submitForm');
        submitModal.addEventListener('click', function(){
        	
        	const rNo = this.parentElement.previousElementSibling.querySelector('input').value;
        	
        	$('#confirm').modal('hide');
        	$.ajax({
        		url:'/shop/deleteReply',
        		data: {rNo:rNo},
        		success: data => {
        			// ë°ì´í„° ì„±ê³µ ì‹œ ì•ŒëŸ¿ì°½
        			if(data == 'success'){
        				alert("ë¦¬ë·°ê°€ ì„±ê³µì ìœ¼ë¡œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
        				location.reload();
        			}
        		},
        		error: data => {
        			console.log(data);
        		}
        	
        	})
        })
	}
        
</script>
</html>